import './style/index.scss'
import React from 'react'
import { render, unmountComponentAtNode } from 'react-dom'
import { merge, compose } from '@boluome/common-lib'

const Mask = (content, options) => {
    const body = document.body
    const node = document.createElement('div')
    const handleContainerClose = () => {
      unmountComponentAtNode(node)
      body.removeChild(node)
    }
    body.appendChild(node)
    render(
      <MaskContainer { ...{ handleContainerClose } } { ...options}>
        { React.cloneElement(content, { handleContainerClose }) }
      </MaskContainer>,
      node
    )
    return handleContainerClose
}

const localMaskContainerStyle = {}
const localMaskStyle = {}
const localContentStyle = {}

const bgWhite = { backgroundColor: '#000' }

const MaskContainer = ({ children, handleContainerClose, mask = true, maskClosable = true, maskPosition = 'fixed', style = {}, maskStyle = {}, contentStyle }) =>
(
  <div className='mask-container' style={ merge(localMaskContainerStyle, style) }>
    <div className='mask'
         ref={ node => node && setTimeout(() => { node.className += ' fade-in' }, 50) }
         onClick={ maskClosable ? handleContainerClose : '' }
         style={ !mask ? merge(localMaskStyle, maskStyle)
                       : compose(merge(localMaskStyle), merge(bgWhite))(maskStyle)
               } ></div>
    <div className='content' style={ merge(localContentStyle, contentStyle) }>
      { children }
    </div>
  </div>
)

export default Mask
